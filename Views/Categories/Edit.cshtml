@model Efood_Menu.Models.FoodItem

@{
    ViewData["Title"] = "Chỉnh sửa món ăn";
}

<div class="edit-food-bg d-flex align-items-center justify-content-center min-vh-100">
    <div class="edit-food-card shadow-lg">
        <div class="edit-food-header d-flex align-items-center gap-2">
            <i class="fas fa-utensils"></i>
            <span>Chỉnh sửa món ăn</span>
        </div>
        <div class="edit-food-body p-4">
            <form asp-action="Edit" enctype="multipart/form-data" autocomplete="off">
                <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>
                <input type="hidden" asp-for="Id" />

                <div class="mb-3">
                    <label asp-for="Name" class="form-label fw-semibold">Tên món ăn</label>
                    <input asp-for="Name" class="form-control edit-food-input" placeholder="Nhập tên món ăn" />
                    <span asp-validation-for="Name" class="text-danger small"></span>
                </div>
                <div class="mb-3">
                    <label asp-for="Description" class="form-label fw-semibold">Mô tả</label>
                    <textarea asp-for="Description" class="form-control edit-food-input" rows="2" placeholder="Nhập mô tả"></textarea>
                    <span asp-validation-for="Description" class="text-danger small"></span>
                </div>
                <div class="mb-3">
                    <label asp-for="Price" class="form-label fw-semibold">Giá</label>
                    <input asp-for="Price" class="form-control edit-food-input" placeholder="Nhập giá" />
                    <span asp-validation-for="Price" class="text-danger small"></span>
                </div>
                <div class="mb-3">
                    <label asp-for="CategoryId" class="form-label fw-semibold">Danh mục</label>
                    <select asp-for="CategoryId" class="form-select edit-food-input" asp-items="ViewBag.CategoryId"></select>
                    <span asp-validation-for="CategoryId" class="text-danger small"></span>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Ảnh chính</label>
                    <input type="file" name="MainImage" accept="image/*" class="form-control edit-food-input" onchange="previewMainImage(event)">
                    <div class="mt-2 text-center">
                        <img id="mainImagePreview" src="@Model.ImageUrl" alt="Ảnh chính" class="edit-food-img-preview" style="@(!string.IsNullOrEmpty(Model.ImageUrl) ? "" : "display:none;")" />
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Ảnh phụ (có thể chọn nhiều)</label>
                    <input type="file" name="AdditionalImages" accept="image/*" class="form-control edit-food-input" multiple onchange="previewAdditionalImages(event)">
                    <div class="mt-2 d-flex flex-wrap gap-2" id="additionalImagesPreview">
                        @if (Model.Images != null)
                        {
                            foreach (var img in Model.Images)
                            {
                                <img src="@img.ImageUrl" alt="Ảnh phụ" class="edit-food-img-preview-small" />
                            }
                        }
                    </div>
                </div>

                <div class="d-flex justify-content-between mt-4 gap-2">
                    <a asp-action="Index" class="btn btn-outline-secondary edit-food-btn">
                        <i class="fas fa-arrow-left"></i> Quay lại
                    </a>
                    <button type="submit" class="btn btn-success edit-food-btn">
                        <i class="fas fa-save"></i> Lưu thay đổi
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Styles {
    <style>
        .edit-food-bg {
            background: #39394f;
        }
        .edit-food-card {
            background: #fff;
            border-radius: 22px;
            max-width: 410px;
            width: 100%;
            box-shadow: 0 8px 32px 0 rgba(60, 60, 90, 0.18);
        }
        .edit-food-header {
            background: linear-gradient(90deg, #ff7e5f 0%, #feb47b 100%);
            color: #fff;
            border-radius: 22px 22px 0 0;
            font-size: 1.35rem;
            font-weight: 700;
            padding: 18px 28px;
            letter-spacing: 0.5px;
        }
        .edit-food-body {
            padding: 2rem 2rem 1.5rem 2rem;
        }
        .edit-food-input {
            background: #f8f8fa;
            border: 1.5px solid #e0e0e0;
            border-radius: 8px;
            color: #232336;
            font-size: 1rem;
            padding: 0.7rem 1rem;
            transition: border-color 0.2s;
        }
        .edit-food-input:focus {
            border-color: #ff7e5f;
            box-shadow: 0 0 0 2px #ff7e5f33;
        }
        .edit-food-img-preview {
            max-width: 120px;
            max-height: 120px;
            border-radius: 10px;
            box-shadow: 0 2px 8px 0 #ff7e5f22;
            object-fit: cover;
        }
        .edit-food-img-preview-small {
            max-width: 80px;
            max-height: 80px;
            border-radius: 8px;
            margin-right: 6px;
            margin-bottom: 6px;
            object-fit: cover;
            box-shadow: 0 1px 4px 0 #ff7e5f22;
        }
        .edit-food-btn {
            min-width: 120px;
            font-weight: 600;
            font-size: 1rem;
            border-radius: 8px;
            padding: 0.6rem 1.2rem;
        }
        .btn-success.edit-food-btn {
            background: linear-gradient(90deg, #ff7e5f 0%, #feb47b 100%);
            border: none;
            color: #fff;
        }
        .btn-outline-secondary.edit-food-btn {
            color: #ff7e5f;
            border-color: #ff7e5f;
            background: #fff;
        }
        .btn-outline-secondary.edit-food-btn:hover {
            background: #ff7e5f;
            color: #fff;
        }
    </style>
}

@section Scripts {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        function previewMainImage(event) {
            const [file] = event.target.files;
            const preview = document.getElementById('mainImagePreview');
            if (file) {
                preview.src = URL.createObjectURL(file);
                preview.style.display = 'block';
            } else {
                preview.src = '';
                preview.style.display = 'none';
            }
        }

        function previewAdditionalImages(event) {
            const files = event.target.files;
            const previewContainer = document.getElementById('additionalImagesPreview');
            previewContainer.innerHTML = '';
            if (files) {
                Array.from(files).forEach(file => {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.className = 'edit-food-img-preview-small';
                    previewContainer.appendChild(img);
                });
            }
        }
    </script>
}
